<html>
    <head>
        <script src="js/jquery-1.6.4.min.js"></script>
        <style>
            body {
                font-family: helvetica, arial, sans-serif;
                font-size: 10pt;
                overflow: hidden;
                width: 300px;
            }

            #about_pandora_enhancer{
                font-weight: bold;
                padding-top: 5px;
				height: 20px;
                margin-left: 5px;
                font-size: 7pt;
                border-top: 1px solid black;
				width: 290px;
				text-align: center;
            }

            #pe-settings{
                padding: 5px;
            }

            .settings-title{
                margin-bottom: 0px;
                font-size: 10pt;
                font-weight: bold;
            }

            input[type="text"]{
                width: 35px;
                text-align: center;
                margin-right: 10px;
            }

            label{
                font-size: 8pt;
                padding-left: 5px;
            }

            .settings-list{
                margin-left: 10px;
            }

            #settings-notifications, #settings-general, #settings-scrobble{
				margin-top: 10px;
                padding: 5px;
                border: 1px solid #d9e0ea;
                -webkit-border-radius: 8px;
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#d9e0ea 100%);
            }

            .actions{
                width: 290px;
                text-align: right;
            }
            
            .link{
                color: #00317F;
            }
            .link:hover{ cursor: pointer; text-decoration: underline; }

            .controlButton{
                width: 49%;
                padding: 5px 20;
                border: 1px solid #d9e0ea;
                -webkit-border-radius: 8px;
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#d9e0ea 100%);
            }

            .controlButton:hover{
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#F2F2F2 100%);
            }

            .controlButton:active{
                background: -webkit-linear-gradient(top, #d9e0ea 0%,#f0f4f7 100%);
            }

			.controlButton[disabled]{
				background: none;
			}
            
            .clear{
                clear: both;
            }
            
            #social{
                float: left;
                width: 85px !important;
                text-align: center;
            }
            
            #gplus{
                padding-top: 5px;
            }
            
            #text-logo{
                width: 195px;
                overflow: hidden;
                font-size: 18pt;
                font-weight: bold;
                color: #082247;
                line-height: 24px;
                float: left;
            }
            
            #text-logo-span{
                color: #0c3a6c;
            }
            
            #text-logo img{
                float: left;
                padding: 0 5px 10px 0;
            }

			#scrobbleTokenContainer{
				display: none;
				padding-right: 5px;
			}
        </style>
        
        <script type="text/javascript">
          (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/plusone.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
          })();
        </script>

        <script type="text/javascript">
			var bgPage = chrome.extension.getBackgroundPage();
            var debugLog = function(text)
            {
                bgPage.debugLog(text);
            };

            var loadCurrentOptions = function()
            {
                //load options and set values
                $("input").each(function(index){
                    var name = $(this).prop("name");
                    var value = localStorage[name];

                    if (value == undefined)
                    {
                        debugLog("No setting found, setting default...");
                        localStorage[name] = true;

                        if(name == 'debug_mode' || name == 'header_config')
                        {
                            localStorage[name] = false;
							value = false;
                        }

                        if (name == "notification_timeout")
                        {
                            localStorage[name] = 3.5;
                        }

						if(name == "scrobble_username")
						{
							localStorage[name] = '';
						}

						if(name == "scrobble_delay")
						{
							localStorage[name] = 60;
						}

						value = localStorage[name];
                    }

                    if (value != "true" || value != "false" && $(this).prop('type') != 'checkbox'){
                        $(this).val(value);
                    } else if (value == "true"){
                        $(this).prop('checked', true);
                    } else {
                        $(this).prop("checked", false);
                    }             
                });

				alert(localStorage['scrobble_session'] != 'null');
				if(localStorage['scrobble_session'] && localStorage['scrobble_session'] != 'null')
				{
					var session = bgPage.responseDispatcher('getSession');

					$('#scrobbleLoginButton').css('display', 'none');
					$('#scrobbleTokenContainer').css('display', 'block');
					$('#scrobbleToken').text(session['name']);// + ' (' + session['name'] + ')');
				}
            };

            var saveCurrentOptions = function()
            {
                if (isNaN($('input[name="notification_timeout"]').val()))
                {
                    alert("Display length must be a number.");
                    $('input[name="notification_timeout"]').val('').focus();
                    return false;
                } 

                //load options and set values
                $("input").each(function(index){
                    var name = $(this).prop("name");
                    var value = false;

                    if($(this).prop('type') == 'checkbox')
                    {
                        value = $(this).prop('checked');
                    }

                    if($(this).prop('type') == 'text')
                    {
                        value = $(this).val();
                    }

                    localStorage[name] = value;          
                });

                return true;
            };

            var enableSaveButton = function()
            {
                $('#saveButton').prop('disabled', false);
                $("#saveButton").click(function(){
                    var saved = saveCurrentOptions();

                    if(saved)
                    {
                        debugLog("saved settings");
                        bgPage.refreshPandora();
                        window.close();
                    } else {
                        debugLog("did not save settings - uh oh!");
                    }
                });
            }

            var disableSaveButton = function()
            {
                $('#saveButton').prop('disabled', true);
            }

            $(document).ready(function(){
                loadCurrentOptions();
                var ext = chrome.app.getDetails();

                $(".setting_checkbox").live('change', function(){
                    enableSaveButton();
                });

                $(".setting_textbox").keypress(function(){
                    enableSaveButton();
                });

                $("#cancelButton").click(function(){
                    window.close();
                });
                
                $("#PE-version").html(ext.version);
                
                $(".link").click(function(){
                    var person = $(this).prop("id");
                    bgPage.ourWebsites(person);
                });

				$('#scrobbleLoginButton').click(function(){
					var username = $('#scrobble_username').val();
					bgPage.responseDispatcher('requestAuthentication', username);
				});

				$('#scrobbleLogoutButton').click(function(){
					bgPage.responseDispatcher('scrobbleLogout');

					$('#scrobbleTokenContainer').css('display', 'none');
					$('#scrobbleToken').text('');
					$('#scrobbleLoginButton').css('display', 'block');
				});
            });
        </script>
    </head>

    <body>
        <div id="pe-settings">
            <div id="text-logo">
                <img src="images/logo-48.png">
                Pandora<br>
                <span id="text-logo-span">Enhancer</span>
            </div>
            
            <div id="social">
                <a href="https://twitter.com/PandoraEnhancer" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false"></a>
                <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
                <div id="gplus">
                    <g:plusone href="https://chrome.google.com/webstore/detail/ipfamfogncacknldkaoekchdeddmfnlg"></g:plusone>
                </div>
            </div>
            
            <div class="clear"></div>
            
            <form id="settings">
                <div id="settings-general">
                    <div class="settings-title">General</div>
                    <div class="settings-list">
                        <input class="setting_checkbox" type="checkbox" name="remove_ads" id="remove_ads"><label for="remove_ads">remove banner ads</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_videos" id="remove_videos"><label for="remove_videos">remove video ads</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_still_listening" id="remove_still_listening"><label for="remove_still_listening">skip "Still Listening?" dialog</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_promobox" id="remove_promobox"><label for="remove_promobox">remove promobox + extend Station List</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_tooltips" id="remove_tooltips"><label for="remove_tooltips">remove tooltips</label><br />
						<input class="setting_checkbox" type="checkbox" name="remove_ribbon" id="remove_ribbon"><label for="remove_ribbon">remove top ribbon</label><br />
                        <input class="setting_checkbox" type="checkbox" name="selectable_lyrics" id="selectable_lyrics"><label for="selectable_lyrics">selectable/copy lyrics</label><br />
						<input class="setting_checkbox" type="checkbox" name="header_config" id="header_config"><label for="header_config">append "configure" link to Pandora header</label><br />
                        <input class="setting_checkbox" type="checkbox" name="debug_mode" id="debug_mode"><label for="debug_mode">debug mode</label>
                    </div>
                </div>
				<div id="settings-scrobble">
                    <div class="settings-title">last.fm Settings</div>
                    <div class="settings-list">
						<button id="scrobbleLoginButton">Authenticate</button>
						<div id="scrobbleTokenContainer">
							<span id="scrobbleToken"></span><button id="scrobbleLogoutButton">Logout</button>
						</div>

                        
						<!--<input class="setting_checkbox" type="checkbox" name="love_with_like" id="love_with_like"><label for="love_with_like">love song on last.fm when I thumb up on Pandora</label><br />
						<label for="scrobble_delay">song scrobble delay (seconds):</label><input type="text" class="setting_textbox" name="scrobble_delay" maxlength="4" />-->
                    </div>
                </div>
                <div id="settings-notifications">
                    <div class="settings-title">Notifications</div>
                    <div class="settings-list">
                        <input class="setting_checkbox" type="checkbox" name="notification_song_change" id="notification_song_change"><label for="notification_song_change">when the song has changed</label><br />
                        <input class="setting_checkbox" type="checkbox" name="notification_still_listening" id="notification_still_listening"><label for="notification_still_listening">when "Still Listening?" dialog is skipped</label><br />
                        <input class="setting_checkbox" type="checkbox" name="notification_video_ad" id="notification_video_ad"><label for="notification_video_ad">when a video ad is blocked</label><br />
                        <input class="setting_checkbox" type="checkbox" name="player_controls" id="player_controls"><label for="player_controls">show player controls in notification</label><br />
                        <label for="notification_timeout">Display length (seconds):</label><input type="text" class="setting_textbox" name="notification_timeout" maxlength="4">
                    </div>
                </div>
            </form>

            <div class="actions">
                <button id="saveButton" class="controlButton" disabled>Save</button> <button class="controlButton" id="cancelButton">Cancel</button>
            </div>
        </div>
        <div id="about_pandora_enhancer">
            PandoraEnhancer (v<span id="PE-version">80085</span>) by <span class="link" id="brandon">Brandon Sachs</span> & <span class="link" id="curt">Curt Hostetter</span>
        </div>
    </body>
</html>