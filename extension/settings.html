<html>
    <head>
        <script src="js/jquery-1.6.4.min.js"></script>
        <style>
            body {
                font-family: helvetica, arial, sans-serif;
                font-size: 10pt;
                overflow: hidden;
                width: 300px;
            }

            #about_pandora_enhancer{
                font-weight: bold;
                padding-top: 10px;
                margin-left: 5px;
                font-size: 7pt;
                border-top: 1px solid black;
				width: 290px;
				text-align: center;
            }

            #pe-settings{
                padding: 5px;
            }

            .settings-title{
                margin-bottom: 0px;
                font-size: 10pt;
                font-weight: bold;
            }

            input[type="text"]{
                width: 35px;
                text-align: center;
                margin-right: 10px;
            }

            label{
                font-size: 8pt;
                padding-left: 5px;
            }

            .settings-list{
                margin-left: 10px;
            }

            #settings-notifications, #settings-general{
                padding: 5px;
                border: 1px solid #d9e0ea;
                -webkit-border-radius: 8px;
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#d9e0ea 100%);
            }

            .actions{
                width: 290px;
                text-align: right;
            }

            button{
                width: 49%;
                padding: 5px 20;
                border: 1px solid #d9e0ea;
                -webkit-border-radius: 8px;
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#d9e0ea 100%);
            }

            button:hover{
                background: -webkit-linear-gradient(top, #f0f4f7 0%,#F2F2F2 100%);
            }

            button:active{
                background: -webkit-linear-gradient(top, #d9e0ea 0%,#f0f4f7 100%);
            }

			button[disabled]{
				background: none;
			}
            
            #text-logo{
                overflow: hidden;
                font-size: 18pt;
                font-weight: bold;
                color: #082247;
                line-height: 24px;
            }
            
            #text-logo-span{
                color: #0c3a6c;
            }
            
            #text-logo img{
                float: left;
                padding: 0 5px 10px 0;
            }
        </style>

        <script type="text/javascript">
            var debugLog = function(text)
            {
                if(localStorage['debug_mode'] == "false") return;
                console.log(text);
            };

            var loadCurrentOptions = function()
            {
                //load options and set values
                $("input").each(function(index){
                    var name = $(this).prop("name");
                    var value = localStorage[name];

                    if (value == undefined)
                    {
                        debugLog("No setting found, setting default...");
                        localStorage[name] = true;

                        if(name == 'debug_mode' || name == 'header_config')
                        {
                            localStorage[name] = false;
							value = false;
                        }

                        if (name == "notification_timeout")
                        {
                            localStorage[name] = 3.5;
                        }

						value = localStorage[name];
                    }

                    if (value != "true" || value != "false" && $(this).prop('type') != 'checkbox'){
                        $(this).val(value);
                    } else if (value == "true"){
                        $(this).prop('checked', true);
                    } else {
                        $(this).prop("checked", false);
                    }             
                });
            };

            var saveCurrentOptions = function()
            {
                if (isNaN($('input[name="notification_timeout"]').val()))
                    {
                    alert("Display length must be a number.");
                    $('input[name="notification_timeout"]').val('').focus();
                    return false;
                } 

                //load options and set values
                $("input").each(function(index){
                    var name = $(this).prop("name");
                    var value = false;

                    if($(this).prop('type') == 'checkbox')
                        {
                        value = $(this).prop('checked');
                    }

                    if($(this).prop('type') == 'text')
                        {
                        value = $(this).val();
                    }

                    localStorage[name] = value;          
                });

                return true;
            };

            var enableSaveButton = function()
            {
                $('#saveButton').prop('disabled', false);
                $("#saveButton").click(function(){
                    var saved = saveCurrentOptions();

                    if(saved)
                    {
                        debugLog("saved settings");
                        chrome.extension.getBackgroundPage().refreshPandora();
                        window.close();
                    } else {
                        debugLog("did not save settings - uh oh!");
                    }
                });
            }

            var disableSaveButton = function()
            {
                $('#saveButton').prop('disabled', true);
            }

            $(document).ready(function(){
                loadCurrentOptions();
                var ext = chrome.app.getDetails();

                $(".setting_checkbox").live('change', function(){
                    enableSaveButton();
                });

                $(".setting_textbox").keypress(function(){
                    enableSaveButton();
                });

                $("#cancelButton").click(function(){
                    window.close();
                });
                
                $("#PE-version").html(ext.version);
            });
        </script>
    </head>

    <body>
        <div id="pe-settings">
            <div id="text-logo">
                <img src="images/logo-48.png">
                Pandora<br>
                <span id="text-logo-span">Enhancer</span>
            </div>
            <form id="settings">
                <div id="settings-general">
                    <div class="settings-title">General</div>
                    <div class="settings-list">
                        <input class="setting_checkbox" type="checkbox" name="remove_ads" id="remove_ads"><label for="remove_ads">remove banner ads</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_videos" id="remove_videos"><label for="remove_videos">remove video ads</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_still_listening" id="remove_still_listening"><label for="remove_still_listening">skip "Still Listening?" dialog</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_promobox" id="remove_promobox"><label for="remove_promobox">remove promobox + extend Station List</label><br />
                        <input class="setting_checkbox" type="checkbox" name="remove_tooltips" id="remove_tooltips"><label for="remove_tooltips">remove tooltips</label><br />
						<input class="setting_checkbox" type="checkbox" name="remove_ribbon" id="remove_ribbon"><label for="remove_ribbon">remove top ribbon</label><br />
                        <input class="setting_checkbox" type="checkbox" name="selectable_lyrics" id="selectable_lyrics"><label for="selectable_lyrics">selectable/copy lyrics</label><br />
						<input class="setting_checkbox" type="checkbox" name="header_config" id="header_config"><label for="header_config">append "configure" link to Pandora header</label><br />
                        <input class="setting_checkbox" type="checkbox" name="debug_mode" id="debug_mode"><label for="debug_mode">debug mode</label>
                    </div>
                </div>
                <br />
                <div id="settings-notifications">
                    <div class="settings-title">Notifications</div>
                    <div class="settings-list">
                        <input class="setting_checkbox" type="checkbox" name="notification_song_change" id="notification_song_change"><label for="notification_song_change">when the song has changed</label><br />
                        <input class="setting_checkbox" type="checkbox" name="notification_still_listening" id="notification_still_listening"><label for="notification_still_listening">when "Still Listening?" dialog is skipped</label><br />
                        <input class="setting_checkbox" type="checkbox" name="notification_video_ad" id="notification_video_ad"><label for="notification_video_ad">when a video ad is blocked</label><br /><br />
                        <label for="notification_timeout">Display length (seconds):</label><input type="text" class="setting_textbox" name="notification_timeout" maxlength="4">
                    </div>
                </div>
            </form>

            <div class="actions">
                <button id="saveButton" disabled>Save</button> <button id="cancelButton">Cancel</button>
            </div>
        </div>
        <div id="about_pandora_enhancer">
            PandoraEnhancer (v<span id="PE-version">80085</span>) by Brandon Sachs & Curt Hostetter
        </div>
    </body>
</html>